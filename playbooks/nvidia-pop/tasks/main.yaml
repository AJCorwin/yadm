---
- name: Fix any broken installs
  ansible.builtin.shell: apt --fix-broken install -y
  become: true
  when: ansible_distribution == "Pop!_OS"

- name: Pause for 1 minutes to build app cache
  ansible.builtin.pause:
    minutes: 1

- name: Killall apts
  ansible.builtin.shell: killall apt apt-get
  become: true

- name: Full apt upgrade
  ansible.builtin.shell: apt full-upgrade -y
  become: true
  retries: 5
  delay: 2
  when: ansible_distribution == "Pop!_OS"

- name: Pause for 1 minutes to build full upgrade cache
  ansible.builtin.pause:
    minutes: 1

- name: KIllall apts return of the kill
  ansible.builtin.shell: killall apt apt-get
  become: true

- name: Update All Packages
  ansible.builtin.apt:
    name: "*"
    state: latest
    update_cache: yes
  retries: 5
  delay: 5
  when: ansible_distribution == "Pop!_OS"

- name: Add PopOS Nvidia Driver
  ansible.builtin.apt_repository:
    repo: ppa:system76-dev/stable
  become: true
  when: ansible_os_family == "Pop!_OS"

- name: Install System-76 Driver
  ansible.builtin.package:
    name: system76-driver
  become: true
  when: ansible_distribution == "Pop!_OS"
